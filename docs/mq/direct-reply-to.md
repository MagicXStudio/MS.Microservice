# 直接答复（Direct Reply-to）

直接答复是一个允许 RPC（请求/回复）客户端设计相似的一个特性，在[教程6](https://www.rabbitmq.com/getstarted.html)的例子中就是用这个避免每个请求都申明一个回复队列。

## Motivation

RPC（请求/回复）是一个非常流程模式来实现像 RabbitMQ 的消息 broker。[教程6](https://www.rabbitmq.com/getstarted.html) 例子中实现了各种客户端。其中一个典型的方式就是用 RPC 客户端发送请求，并且被路由到一个长久的服务端队列。RPC 服务器通过客户端在 `reply-to` 头部信息中命名队列，来消费从这个队列过来的请求并回复所有客户端。

客户端的队列来自那？客户端能给每个请求/回复对申明一个单使用队列。但是这不高效；即使是临时的无镜像队列，创建和删除的成本也可能很高(与发送消息的成本相比)。尤其是在集群中所有的节点都同意队列已经创建，甚至它不是镜像的。

另一个客户端也可以针对回复创建一个长连接队列。但管理起来很繁琐，尤其是如果客户本身并不是长连接的话。

直接答复特性允许  RPC 客户端从它们的 RPC 服务器接收直接响应，不需要经过答复队列。这里的 “直接” 仍然意味着通过相同的连接和一个 RabbitMQ 节点。这里不存在直接网络连接 RPC 客户端和 RPC 服务端。

## 如何使用 Direct Reply-to

要使用直接答复，客户端需要以下两个步骤：

- 在 no-ack 模式中，从伪队列 `amq.rabbitmq.reply-to` 消费。这里不需要首先声明这个“队列”，尽管如果它想的话，客户端可以这样做。
- 在它们的请求消息中将 `reply-to` 设置为 `amq.rabbitmq.reply-to`

